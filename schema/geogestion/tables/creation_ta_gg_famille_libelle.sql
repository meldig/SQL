/*
TA_GG_FAMILLE_LIBELLE: Table de relation entre les tables TA_LIBELLE et TA_FAMILLE afin d'associer à chaque libelle à sa famille.
*/

-- 1.1. Création de la table
CREATE TABLE G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE(
    objectid NUMBER(38,0) GENERATED BY DEFAULT AS IDENTITY,
    fid_famille NUMBER(38,0) NOT NULL,
    fid_libelle NUMBER(38,0) NOT NULL
);

-- 1.2. Création des commentaires
COMMENT ON TABLE G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE IS 'Table contenant les identifiant des tables TA_GG_LIBELLE et TA_GG_FAMILLE permettant de joindre le libellé à sa famille.';
COMMENT ON COLUMN G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE.objectid IS 'Identifiant de chaque ligne.';
COMMENT ON COLUMN G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE.fid_famille IS 'Identifiant de chaque famille de libellés - FK de la table TA_GG_FAMILLE.';
COMMENT ON COLUMN G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE.fid_libelle IS 'Identifiant de chaque libelle - FK de la table TA_GG_LIBELLE.';

-- 1.3. Création de la clé primaire
ALTER TABLE G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE
ADD CONSTRAINT TA_GG_FAMILLE_LIBELLE_PK 
PRIMARY KEY("OBJECTID")
USING INDEX TABLESPACE "G_ADT_INDX";

-- 1.4. Création des clés étrangères
-- 1.4.1. Vers la table TA_GG_FAMILLE
ALTER TABLE G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE
ADD CONSTRAINT TA_GG_FAMILLE_LIBELLE_FID_FAMILLE_FK
FOREIGN KEY("FID_FAMILLE")
REFERENCES G_GESTIONGEO.TA_GG_FAMILLE(objectid);

-- 1.4.2. Vers la table TA_GG_LIBELLE
ALTER TABLE G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE
ADD CONSTRAINT TA_GG_FAMILLE_LIBELLE_FID_LIBELLE_FK
FOREIGN KEY("FID_LIBELLE")
REFERENCES G_GESTIONGEO.TA_GG_LIBELLE(objectid);

-- 1.5. Création de l'index de la clé étrangère
CREATE INDEX TA_GG_FAMILLE_LIBELLE_FID_FAMILLE_IDX ON TA_GG_FAMILLE_LIBELLE(fid_famille)
TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GG_FAMILLE_LIBELLE_FID_LIBELLE_IDX ON TA_GG_FAMILLE_LIBELLE(fid_libelle)
TABLESPACE G_ADT_INDX;

-- 1.6. Un libelle ne peut pas avoir deux fois la meme famille
ALTER TABLE G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE 
ADD CONSTRAINT TA_GG_FAMILLE_LIBELLE_FID_FAMILLE_FID_LIBELLE_UNIQUE
UNIQUE (FID_FAMILLE,FID_LIBELLE);

-- 1.5. Droits
GRANT SELECT, UPDATE, INSERT, DELETE ON G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE TO G_GESTIONGEO_MAJ;
GRANT SELECT ON G_GESTIONGEO.TA_GG_FAMILLE_LIBELLE TO G_GESTIONGEO_LEC;