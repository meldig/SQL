/*
TA_GG_LIBELLE_CORRESPONDANCE: Table de correspondance pour associé à chaque libelle son libelles courts.
*/

-- 1. Creation de la table TA_GG_LIBELLE_CORRESPONDANCE
-- 1.1. Création de la table
CREATE TABLE G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE(
    objectid NUMBER(38,0) GENERATED BY DEFAULT AS IDENTITY,
    fid_libelle NUMBER(38,0) NOT NULL,
    fid_libelle_court NUMBER(38,0) NOT NULL
);

-- 1.2. Création des commentaires
COMMENT ON TABLE G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE IS 'Table contenant les identifiants des tables TA_GG_LIBELLE et TA_GG_LIBELLE_COURT, permettant de joindre les libelles à leur libellés courts.';
COMMENT ON COLUMN G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE.objectid IS 'clé primaire de la table TA_GG_LIBELLE_CORRESPONDANCE.';
COMMENT ON COLUMN G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE.fid_libelle IS 'Identifiant des libelles - FK de la table TA_GG_LIBELLE.';
COMMENT ON COLUMN G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE.fid_libelle_court IS 'Identifiant de chaque LIBELLE court - FK de la table TA_GG_LIBELLE_COURT.';

-- 1.3. Création de la clé primaire
ALTER TABLE G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE
ADD CONSTRAINT TA_GG_LIBELLE_CORRESPONDANCE_PK 
PRIMARY KEY("OBJECTID")
USING INDEX TABLESPACE "G_ADT_INDX";

-- 1.4. Création des clés étrangères
-- 1.4.1. Vers la table TA_GG_LIBELLE
ALTER TABLE G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE
ADD CONSTRAINT TA_GG_LIBELLE_CORRESPONDANCE_FID_LIBELLE_FK
FOREIGN KEY("FID_LIBELLE")
REFERENCES G_GESTIONGEO.TA_GG_LIBELLE(objectid);

-- 1.4.2. Vers la table TA_GG_LIBELLE_COURT
ALTER TABLE G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE
ADD CONSTRAINT TA_GG_LIBELLE_CORRESPONDANCE_FID_LIBELLE_COURT_FK
FOREIGN KEY("FID_LIBELLE_COURT")
REFERENCES G_GESTIONGEO.TA_GG_LIBELLE_COURT(objectid);


-- 1.5. Création de l'index de la clé étrangère
CREATE INDEX TA_GG_LIBELLE_CORRESPONDANCE_FID_LIBELLE_IDX ON TA_GG_LIBELLE_CORRESPONDANCE(fid_libelle)
TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GG_LIBELLE_CORRESPONDANCE_FID_LIBELLE_COURT_IDX ON TA_GG_LIBELLE_CORRESPONDANCE(fid_libelle_court)
TABLESPACE G_ADT_INDX;

-- 1.6. Un libelle ne peut pas avoir deux fois la meme libelle court
ALTER TABLE G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE 
ADD CONSTRAINT TA_GG_LIBELLE_CORRESPONDANCE_FID_LIBELLE_FID_LIBELLE_COURT_UNIQUE
UNIQUE (FID_LIBELLE,FID_LIBELLE_COURT);

-- 1.7. Droits
GRANT SELECT, UPDATE, INSERT, DELETE ON G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE TO G_GESTIONGEO_MAJ;
GRANT SELECT ON G_GESTIONGEO.TA_GG_LIBELLE_CORRESPONDANCE TO G_GESTIONGEO_LEC;